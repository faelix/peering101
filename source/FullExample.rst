============
Full Example
============

An example of a fully worked through configuration.

Cisco IOS
---------

When setting up the peer:

.. code-block:: none

  router bgp 65000
    neighbor 10.1.1.1 remote-as 64512
    neighbor 10.1.1.1 prefix-list EXAMPLE-in in
    neighbor 10.1.1.1 prefix-list AS65000 out
    neighbor 10.1.1.1 route-map EXAMPLE-in in
    neighbor 10.1.1.1 route-map AS65000 out
  route-map EXAMPLE-in permit 10
    match as-path EXAMPLE-in

Automatically generated by bgpq3, once per day:

.. code-block:: none

  no ip prefix-list EXAMPLE-in
    ip prefix-list EXAMPLE-in permit 192.0.2.0/24
  no ip as-path access-list EXAMPLE-in
    ip as-path access-list EXAMPLE-in permit ^64512(_64512)*$
    ip as-path access-list EXAMPLE-in permit ^64512(_[0-9]+)*_(65001|65002|65003)$
  clear ip bgp 10.1.1.1 soft

Note that "soft" will do a route-refresh is supported, or soft-reconfiguration if configured. It will not reset the session.

Cisco IOS-XR
------------

Once IOS finished, re-run bgpq3 with "-X" -- note that only prefix lists are supported.

Juniper JUNOS
-------------

Once IOS finished, re-run bgpq3 with "-J" for both prefix lists and as-sets.

Brocade IronWare
----------------

While very Cisco like, features will need to be tested before posting any code here.

Arista EOS
----------

While very Cisco like, features will need to be tested before posting any code here.

BIRD
----

Once IOS finished, re-run bgpq3 with "-b" for both prefix lists and as-sets.

MikroTik RouterOS
-----------------

When setting up the peer:

.. code-block:: none

  /routing bgp instance
    set default as=65000 router-id=192.0.2.1
  /routing bgp network
    add network=198.51.100.0/24
  /routing bgp peer
    add in-filter=EXAMPLE-in name=example-peering remote-address=10.1.1.1 remote-as=64512

  /routing filter
    add action=accept chain=EXAMPLE-in prefix=192.0.2.0/24
    add action=accept chain=EXAMPLE-in bgp-as-path="^64512(_64512)*$"
    add action=accept chain=EXAMPLE-in bgp-as-path="^64512(_[0-9]+)*_(65001|65002|65003)$"

You just need a cron job to run:

.. code-block:: none

  /routing filter
    remove [/routing filter find where chain=EXAMPLE-in]
    add action=accept chain=EXAMPLE-in prefix=...

You can generate a "prefix list" for that cron job like this:

.. code-block:: none

  bgpq3 -F "add action=accept chain=EXAMPLE-in prefix=%n/%l\n" AS64512

and more...
